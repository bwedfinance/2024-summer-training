<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-06-27">

<title>School Finance Equity Training, Summer 2024 - Data cleaning and processing in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/countdown-0.4.0/countdown.css" rel="stylesheet">
<script src="../../site_libs/countdown-0.4.0/countdown.js"></script>


</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Data cleaning and processing in R</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/primary_one-color_reverse.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class Setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Resources</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#review" id="toc-review" class="nav-link active" data-scroll-target="#review">Review</a>
  <ul class="collapse">
  <li><a href="#review-from-week-2" id="toc-review-from-week-2" class="nav-link" data-scroll-target="#review-from-week-2">Review from Week 2</a></li>
  </ul></li>
  <li><a href="#principles-of-tidy-data" id="toc-principles-of-tidy-data" class="nav-link" data-scroll-target="#principles-of-tidy-data">Principles of tidy data</a>
  <ul class="collapse">
  <li><a href="#cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis" id="toc-cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis" class="nav-link" data-scroll-target="#cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis">Cleaning your data: One of the most important and under-appreciated stages of good data analysis</a></li>
  <li><a href="#the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like" id="toc-the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like" class="nav-link" data-scroll-target="#the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like">The principles of “tidy data” provide a helpful vision of what good, clean data should look like</a></li>
  <li><a href="#it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data" id="toc-it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data" class="nav-link" data-scroll-target="#it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data">It takes a bit of work to make data tidy, including the use of functions to reshape your data</a></li>
  <li><a href="#it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont." id="toc-it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont." class="nav-link" data-scroll-target="#it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont.">It takes a bit of work to make data tidy, including the use of functions to reshape your data, cont.</a></li>
  <li><a href="#pivot_longer-is-useful-when-a-variable-is-embedded-across-several-column-names" id="toc-pivot_longer-is-useful-when-a-variable-is-embedded-across-several-column-names" class="nav-link" data-scroll-target="#pivot_longer-is-useful-when-a-variable-is-embedded-across-several-column-names"><code>pivot_longer()</code> is useful when a variable is embedded across several column names</a></li>
  <li><a href="#live-coding-example-using-pivot_longer" id="toc-live-coding-example-using-pivot_longer" class="nav-link" data-scroll-target="#live-coding-example-using-pivot_longer">Live coding example: Using <code>pivot_longer()</code></a></li>
  <li><a href="#if-your-data-includes-data-from-a-single-observation-spread-across-multiple-rows-use-pivot_wider" id="toc-if-your-data-includes-data-from-a-single-observation-spread-across-multiple-rows-use-pivot_wider" class="nav-link" data-scroll-target="#if-your-data-includes-data-from-a-single-observation-spread-across-multiple-rows-use-pivot_wider">If your data includes data from a single observation spread across multiple rows, use <code>pivot_wider()</code></a></li>
  <li><a href="#live-coding-example-using-pivot_wider" id="toc-live-coding-example-using-pivot_wider" class="nav-link" data-scroll-target="#live-coding-example-using-pivot_wider">Live coding example: Using <code>pivot_wider()</code></a></li>
  </ul></li>
  <li><a href="#techniques-to-clean-messy-data" id="toc-techniques-to-clean-messy-data" class="nav-link" data-scroll-target="#techniques-to-clean-messy-data">Techniques to clean messy data</a>
  <ul class="collapse">
  <li><a href="#cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach" id="toc-cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach" class="nav-link" data-scroll-target="#cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach">Cleaning data can be challenging, but it’s easier if you take a systematic approach</a></li>
  <li><a href="#live-coding-example-florida_clean.r" id="toc-live-coding-example-florida_clean.r" class="nav-link" data-scroll-target="#live-coding-example-florida_clean.r">Live coding example: florida_clean.R</a></li>
  </ul></li>
  <li><a href="#joining-datasets" id="toc-joining-datasets" class="nav-link" data-scroll-target="#joining-datasets">Joining datasets</a>
  <ul class="collapse">
  <li><a href="#your-data-will-rarely-come-to-you-in-a-single-table.-you-will-need-to-join-functions-to-merge-dataframes-together" id="toc-your-data-will-rarely-come-to-you-in-a-single-table.-you-will-need-to-join-functions-to-merge-dataframes-together" class="nav-link" data-scroll-target="#your-data-will-rarely-come-to-you-in-a-single-table.-you-will-need-to-join-functions-to-merge-dataframes-together">Your data will rarely come to you in a single table. You will need to join functions to merge dataframes together</a></li>
  <li><a href="#using-left_join-to-merge-datasets-will-help-preserve-your-data" id="toc-using-left_join-to-merge-datasets-will-help-preserve-your-data" class="nav-link" data-scroll-target="#using-left_join-to-merge-datasets-will-help-preserve-your-data">Using <code>left_join()</code> to merge datasets will help preserve your data</a></li>
  <li><a href="#coding-example-how-to-use-left_join" id="toc-coding-example-how-to-use-left_join" class="nav-link" data-scroll-target="#coding-example-how-to-use-left_join">Coding example: How to use <code>left_join()</code></a></li>
  <li><a href="#as-you-merge-dataframes-be-sure-to-use-anti_join-to-examine-missing-data" id="toc-as-you-merge-dataframes-be-sure-to-use-anti_join-to-examine-missing-data" class="nav-link" data-scroll-target="#as-you-merge-dataframes-be-sure-to-use-anti_join-to-examine-missing-data">As you merge dataframes, be sure to use <code>anti_join()</code> to examine missing data</a></li>
  <li><a href="#coding-example-how-to-use-anti_join" id="toc-coding-example-how-to-use-anti_join" class="nav-link" data-scroll-target="#coding-example-how-to-use-anti_join">Coding example: How to use <code>anti_join()</code></a></li>
  </ul></li>
  <li><a href="#break" id="toc-break" class="nav-link" data-scroll-target="#break">Break</a></li>
  <li><a href="#an-example-with-tidycensus" id="toc-an-example-with-tidycensus" class="nav-link" data-scroll-target="#an-example-with-tidycensus">An example with <code>tidycensus</code></a>
  <ul class="collapse">
  <li><a href="#the-tidycensus-package-can-provide-data-at-the-school-district-level-that-may-be-helpful-for-school-finance-analysis" id="toc-the-tidycensus-package-can-provide-data-at-the-school-district-level-that-may-be-helpful-for-school-finance-analysis" class="nav-link" data-scroll-target="#the-tidycensus-package-can-provide-data-at-the-school-district-level-that-may-be-helpful-for-school-finance-analysis">The <code>tidycensus</code> package can provide data at the school district level that may be helpful for school finance analysis</a></li>
  <li><a href="#to-get-started-youll-need-to-sign-up-for-an-api-key-with-the-census-bureau" id="toc-to-get-started-youll-need-to-sign-up-for-an-api-key-with-the-census-bureau" class="nav-link" data-scroll-target="#to-get-started-youll-need-to-sign-up-for-an-api-key-with-the-census-bureau">To get started, you’ll need to sign up for an API key with the Census Bureau</a></li>
  </ul></li>
  <li><a href="#in-class-exercise" id="toc-in-class-exercise" class="nav-link" data-scroll-target="#in-class-exercise">In-class exercise</a>
  <ul class="collapse">
  <li><a href="#in-class-coding-example-clean_and_join.r-13" id="toc-in-class-coding-example-clean_and_join.r-13" class="nav-link" data-scroll-target="#in-class-coding-example-clean_and_join.r-13">In-class coding example: clean_and_join.R (1/3)</a></li>
  <li><a href="#in-class-coding-example-clean_and_join.r-23" id="toc-in-class-coding-example-clean_and_join.r-23" class="nav-link" data-scroll-target="#in-class-coding-example-clean_and_join.r-23">In-class coding example: clean_and_join.R (2/3)</a></li>
  <li><a href="#in-class-coding-example-clean_and_join.r-33" id="toc-in-class-coding-example-clean_and_join.r-33" class="nav-link" data-scroll-target="#in-class-coding-example-clean_and_join.r-33">In-class coding example: clean_and_join.R (3/3)</a></li>
  </ul></li>
  <li><a href="#homework-assignment" id="toc-homework-assignment" class="nav-link" data-scroll-target="#homework-assignment">Homework assignment</a>
  <ul class="collapse">
  <li><a href="#this-weeks-assignment" id="toc-this-weeks-assignment" class="nav-link" data-scroll-target="#this-weeks-assignment">This week’s assignment</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week_04_slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data cleaning and processing in R</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 27, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="review" class="level1">
<h1>Review</h1>
<section id="review-from-week-2" class="level2">
<h2 class="anchored" data-anchor-id="review-from-week-2">Review from Week 2</h2>
<p>General tips and things to keep in mind from talking with several of you:</p>
<ul>
<li>Keep all of your variable names lowercase (including dataframes!) — it helps prevent potential problems and errors.</li>
<li>In order to create a scatterplot or histogram with <code>ggplot()</code>, you need to make sure the dataframe you want to use is available in your working environment. Reminder: your working environment will be empty when you start RStudio — you’ll need to run each line of code that comes <em>before</em> your plot code in order for it to run successfully.</li>
<li>To run the code for a plot, you can execute it by clicking “Run” or hitting Command + Enter on your keybord if you have either 1) placed your cursor anywhere in the code for the plot or 2) you’ve higlighted all of the lines of code to create your plot (highlighting a single line will <em>not</em> work).</li>
</ul>
</section>
</section>
<section id="principles-of-tidy-data" class="level1 page-columns page-full">
<h1>Principles of tidy data</h1>
<section id="cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-your-data-one-of-the-most-important-and-under-appreciated-stages-of-good-data-analysis">Cleaning your data: One of the most important and under-appreciated stages of good data analysis</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>“Tidy datasets are all alike, but every messy dataset is messy in its own way.” - Hadley Wickham</strong></p>
</div>
</div>
</div>
<ul>
<li><p>Education finance data, like most other data, rarely come to us in a format that is plug-and-play ready for analysis.</p></li>
<li><p>A high-quality analysis of your state’s school finance system must start with gathering and cleaning relevant data.</p></li>
<li><p>This starts with ensuring that each dataframe of raw data you read into R goes through a process of becoming “tidy” — once you have tidy data, merging and visualizing data becomes much easier.</p></li>
<li><p>The process of tidying your data is also helpful for identifying anomalies or outliers in your raw data files.</p></li>
</ul>
</section>
<section id="the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like" class="level2 smaller page-columns page-full">
<h2 class="smaller anchored" data-anchor-id="the-principles-of-tidy-data-provide-a-helpful-vision-of-what-good-clean-data-should-look-like">The principles of “tidy data” provide a helpful vision of what good, clean data should look like</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Tidy data follows three rules:</p>
<ol type="1">
<li>Each column is a variable</li>
<li>Each row is an observation</li>
<li>Each cell is a value</li>
</ol>
</div><div class="column" style="width:50%;">
<p>Building tidy datasets will:</p>
<p>• Bring consistency to your data across scripts/projects</p>
<p>• Make it easier to work with functions in the `tidyverse`, which is built to work will with “tidy” data</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/08547/images/r4ds/tidy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: <a href="https://r4ds.had.co.nz/tidy-data.html">R for Data Science</a></p>
</div></div></section>
<section id="it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data" class="level2">
<h2 class="anchored" data-anchor-id="it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data">It takes a bit of work to make data tidy, including the use of functions to reshape your data</h2>
<p>Datasets can violate the principles of tidy data in several ways:</p>
<ul>
<li><strong>Variables can be embedded across columns</strong>: An common example is when multiple columns represent data from different years. In this case, a variable (year) is actually represented by column names instead of being captured in its own “year” column.</li>
<li><strong>Solution</strong>: Pivot your data longer!</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  state sy20_rev sy21_rev sy22_rev
  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 AL     2023902  2304983  3930833
2 AK      230993   233466   283948
3 AZ      203492   390282   409828</code></pre>
</div>
</div>
</section>
<section id="it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont." class="level2">
<h2 class="anchored" data-anchor-id="it-takes-a-bit-of-work-to-make-data-tidy-including-the-use-of-functions-to-reshape-your-data-cont.">It takes a bit of work to make data tidy, including the use of functions to reshape your data, cont.</h2>
<ul>
<li><strong>A single observation may be spread across multiple rows</strong>: This can happen when one column includes multiple variable types within it. And example would be if a dataframe had a “data_type” column that included entries like “n_tested” and “pct_prof”.</li>
<li><strong>Solution</strong>: Pivot your table wider!</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  sch_name         data_type  value
  &lt;chr&gt;            &lt;chr&gt;      &lt;dbl&gt;
1 Alpha Elementary n_tested  230   
2 Alpha Elementary pct_prof    0.53
3 Bravo Middle     n_tested  492   
4 Bravo Middle     pct_prof    0.34
5 Charlie High     n_tested  434   
6 Charlie High     pct_prof    0.43</code></pre>
</div>
</div>
</section>
<section id="pivot_longer-is-useful-when-a-variable-is-embedded-across-several-column-names" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="pivot_longer-is-useful-when-a-variable-is-embedded-across-several-column-names"><code>pivot_longer()</code> is useful when a variable is embedded across several column names</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://epirhandbook.com/en/images/pivoting/pivot_longer_new.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: <a href="https://epirhandbook.com/en/pivoting-data.html#wide-to-long">The Epidemiologist R Handbook</a></p>
</div></div></section>
<section id="live-coding-example-using-pivot_longer" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="live-coding-example-using-pivot_longer">Live coding example: Using <code>pivot_longer()</code></h2>
<p>Key arguments of the <code>pivot_longer()</code> function:</p>
<ul>
<li><code>cols</code>: The names of the columns to pivot using <a href="https://tidyr.tidyverse.org/reference/tidyr_tidy_select.html"><code>tidy-select</code></a></li>
<li><code>names_to</code>: The name for the new character column</li>
<li><code>values_to</code>: The name for the new values column</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PIVOT LONGER EXAMPLE</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load ----</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data for analysis</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>usa_2008_2021 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"slides/week_04/data/usa_2008_2021.csv"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean and analyze data ----</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Per-Pupil Education Streams </span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>usa_all_education_streams_long <span class="ot">&lt;-</span> usa_2008_2021 <span class="sc">|&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out years that we don't need in our analysis </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">2007</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select variables that we want to use to pivot our data longer </span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, usa_state_pp, usa_local_pp, usa_federal_pp) <span class="sc">|&gt;</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> usa_state_pp<span class="sc">:</span>usa_federal_pp, <span class="co"># These are the columns we want to pivot </span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"revenue_source"</span>, <span class="co"># The name for the new character column</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"revenue"</span>) <span class="sc">|&gt;</span> <span class="co"># The name for the new values </span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert the column created with "names_to" to a nicely-labeled factor</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue_source =</span> <span class="fu">factor</span>(revenue_source,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># specify the order of values in this variable</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"usa_state_pp"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"usa_local_pp"</span>, </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"usa_federal_pp"</span>),</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># give the variable nice labels</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># these need to be the same order as the levels you set!</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Local"</span>, <span class="st">"State"</span>, <span class="st">"Federal"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column that indicates all of this data is national</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="st">"United States"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a nicely-formatted year column</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_1 =</span> year <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_2 =</span> <span class="fu">str_sub</span>(<span class="fu">as.character</span>(year), <span class="at">start =</span> <span class="dv">3</span>),</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">paste0</span>(year_1, <span class="st">"-"</span>, year_2)) <span class="sc">|&gt;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove intermediate year columns |&gt; </span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year_1, <span class="sc">-</span>year_2) <span class="sc">|&gt;</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reorder our columns so that state and year are first</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, year, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="if-your-data-includes-data-from-a-single-observation-spread-across-multiple-rows-use-pivot_wider" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="if-your-data-includes-data-from-a-single-observation-spread-across-multiple-rows-use-pivot_wider">If your data includes data from a single observation spread across multiple rows, use <code>pivot_wider()</code></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://bcheggeseth.github.io/112_fall_2022/images/pivot_wider.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: <a href="https://bcheggeseth.github.io/112_fall_2022/reshaping-data.html#wider">Macalester College COMP/STAT 112: Introduction to Data Science</a></p>
</div></div></section>
<section id="live-coding-example-using-pivot_wider" class="level2">
<h2 class="anchored" data-anchor-id="live-coding-example-using-pivot_wider">Live coding example: Using <code>pivot_wider()</code></h2>
<p>Breaking down the code:</p>
<ul>
<li><strong>names_from:</strong> The column with values that include multiple variables; will be pivoted into column names.</li>
<li><strong>values_from:</strong> The column with values will be used as cell values after pivoting.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PIVOT WIDER EXAMPLE</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dist_sped_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/dist_sped_raw.csv"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># clean special ed data ---------</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dist_sped <span class="ot">&lt;-</span> dist_sped_raw <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cat_number, <span class="co"># The column where we are using the value as a column name </span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> enroll) <span class="co"># The column whose values will be used as the values in the cell </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="techniques-to-clean-messy-data" class="level1">
<h1>Techniques to clean messy data</h1>
<section id="cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="cleaning-data-can-be-challenging-but-its-easier-if-you-take-a-systematic-approach">Cleaning data can be challenging, but it’s easier if you take a systematic approach</h2>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 88%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Goal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Data import</td>
<td>Ensure your import function is set up to read the data properly</td>
</tr>
<tr class="even">
<td>Column names</td>
<td><p>Reformat or manually create column names that are:</p>
<ul>
<li><p>lowercase</p></li>
<li><p>use underscores instead of spaces</p></li>
<li><p>do not begin with a number</p></li>
<li><p>follow a consistent format</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>Mis-formatted data</td>
<td>Work with functions from base R like <code>as.numeric()</code> or from the <code>tidyverse</code> packages like <code>stringr</code> to clean the data that appear in a different format than you want.</td>
</tr>
<tr class="even">
<td>Missing data</td>
<td>Identify where in your dataset there are missing variables and/or outliers - this may be more of an iterative process as your explore your data.</td>
</tr>
</tbody>
</table>
</section>
<section id="live-coding-example-florida_clean.r" class="level2">
<h2 class="anchored" data-anchor-id="live-coding-example-florida_clean.r">Live coding example: florida_clean.R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load ---------</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># load fl revenue raw data</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>fl_tax_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/1819Tables.xlsx"</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="dv">9</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># skip first row when reading data</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>fl_tax_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/1819Tables.xlsx"</span>, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="dv">9</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># limit data to max of 67 rows</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>fl_tax_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/1819Tables.xlsx"</span>, </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="dv">9</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">n_max =</span> <span class="dv">67</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># clean ---------</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># fix column names</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>fl_tax_clean <span class="ot">&lt;-</span> fl_tax_raw <span class="sc">|&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert colnames to lowercase</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(tolower) </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># look at column names</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fl_tax_clean)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of new column names</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"district"</span>, </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>               <span class="st">"operating_millage"</span>, </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>               <span class="st">"tax_roll_fy18"</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>               <span class="st">"operating_tax_yield"</span>, </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>               <span class="st">"required_effort"</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># manually replace column names</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fl_tax_clean) <span class="ot">&lt;-</span> new_names</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co"># look at column names now</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fl_tax_clean)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># look at district names</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(fl_tax_clean<span class="sc">$</span>district)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># convert district names to title case</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>fl_tax_clean <span class="ot">&lt;-</span> fl_tax_clean <span class="sc">|&gt;</span> </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">str_to_title</span>(district))</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># look at district names now</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(fl_tax_clean<span class="sc">$</span>district)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co"># fix a special case - "Desoto" should be "DeSoto"</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>fl_tax_clean<span class="sc">$</span>district[<span class="dv">14</span>]</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co"># replace all instances of "Desoto" with "DeSoto"</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>fl_tax_clean <span class="ot">&lt;-</span> fl_tax_clean <span class="sc">|&gt;</span> </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">str_replace_all</span>(district, <span class="st">"Desoto"</span>, <span class="st">"DeSoto"</span>))</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="co"># check that the above code worked</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>fl_tax_clean<span class="sc">$</span>district[<span class="dv">14</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="joining-datasets" class="level1 page-columns page-full">
<h1>Joining datasets</h1>
<section id="your-data-will-rarely-come-to-you-in-a-single-table.-you-will-need-to-join-functions-to-merge-dataframes-together" class="level2">
<h2 class="anchored" data-anchor-id="your-data-will-rarely-come-to-you-in-a-single-table.-you-will-need-to-join-functions-to-merge-dataframes-together">Your data will rarely come to you in a single table. You will need to join functions to merge dataframes together</h2>
<p>To join two dataframes, they need to share a common column with a unique identifier.</p>
<p>State departments of education typically assign a unique ID number to each school district. <strong>Make sure this is available in your datasets.</strong></p>
<p>Joining datasets on a name (e.g.&nbsp;school or district) can create problems based on:</p>
<ul>
<li>Capitalization (Mcgregor v. McGregor)</li>
<li>Abbreviation (St.&nbsp;Paul v. Saint Paul)</li>
<li>Mis-spelling (it happens!)</li>
</ul>
</section>
<section id="using-left_join-to-merge-datasets-will-help-preserve-your-data" class="level2 smaller page-columns page-full">
<h2 class="smaller anchored" data-anchor-id="using-left_join-to-merge-datasets-will-help-preserve-your-data">Using <code>left_join()</code> to merge datasets will help preserve your data</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Once you have dataframes that share a common ID column, start with your most reliable set of data (typically student count data like ADM or enrollment) and use <code>left_join()</code> to attach additional data to that table.</p></li>
<li><p>This approach will preserve your original data, keeping the number of rows (e.g.&nbsp;districts or schools) consistent as you use <code>left_join()</code> to add data by adding more columns.</p></li>
<li><p>When a record in the “left” dataframe does not have a match in the “right” dataframe, <code>left_join()</code> will impute a value of <code>NA</code> for all such instances.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/join-left.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: <a href="https://r4ds.had.co.nz/relational-data.html#outer-join">R for Data Science</a></p>
</div></div></section>
<section id="coding-example-how-to-use-left_join" class="level2">
<h2 class="anchored" data-anchor-id="coding-example-how-to-use-left_join">Coding example: How to use <code>left_join()</code></h2>
<ul>
<li><strong>Example 1:</strong> The common ID columns have the same variable names (sch_id)</li>
<li><strong>Example 2:</strong> The common ID columns have different variable names. The <strong>sch_clean</strong> dataframe’s variable is sch_id, while the <strong>sch_el</strong> data frame’s variable name is school_id. The column names can be different, but the values within the cells must be the same so we can join them.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join data ---------</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAMPLE 1: Join the ADM, special education, economically disadvantaged, and ELL student data</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sch_clean <span class="ot">&lt;-</span> sch_adm <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sch_ed, <span class="at">by =</span> <span class="st">"sch_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sch_sped, <span class="at">by =</span> <span class="st">"sch_id"</span>) </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAMPLE 2: Join the ELL data </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>sch_clean <span class="ot">&lt;-</span> sch_clean <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sch_el, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sch_id"</span> <span class="ot">=</span> <span class="st">"school_id"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="as-you-merge-dataframes-be-sure-to-use-anti_join-to-examine-missing-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="as-you-merge-dataframes-be-sure-to-use-anti_join-to-examine-missing-data">As you merge dataframes, be sure to use <code>anti_join()</code> to examine missing data</h2>
<p>Using the <code>anti_join()</code> function from the <a href="https://dplyr.tidyverse.org/index.html">dplyr</a> package in R returns all rows in one data frame that do not have matching values in another data frame. Using anti_join() allows you to explore the incongruities in your data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://d33wubrfki0l68.cloudfront.net/f29a85efd53a079cc84c14ba4ba6894e238c3759/c1408/diagrams/join-anti.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: <a href="https://r4ds.had.co.nz/relational-data.html#understanding-joins">R for Data Science</a></p>
</div></div></section>
<section id="coding-example-how-to-use-anti_join" class="level2">
<h2 class="anchored" data-anchor-id="coding-example-how-to-use-anti_join">Coding example: How to use <code>anti_join()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># matching tests --------</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># only charlie county, which only has adm of 5</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>dist_no_area <span class="ot">&lt;-</span> dist_summary <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(state_dist_area)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check to make sure there aren't any distircts in the area df</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># that arent in our dist_summary df</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># no misses!</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>area_no_dist <span class="ot">&lt;-</span> state_dist_area <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(dist_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="break" class="level1">
<h1>Break</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_2caf595c" data-update-every="1" tabindex="0" style="right:0;bottom:0;font-size:1.5em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="an-example-with-tidycensus" class="level1">
<h1>An example with <code>tidycensus</code></h1>
<section id="the-tidycensus-package-can-provide-data-at-the-school-district-level-that-may-be-helpful-for-school-finance-analysis" class="level2">
<h2 class="anchored" data-anchor-id="the-tidycensus-package-can-provide-data-at-the-school-district-level-that-may-be-helpful-for-school-finance-analysis">The <code>tidycensus</code> package can provide data at the school district level that may be helpful for school finance analysis</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p>The Census Bureau collects a lot of information that is reported at the school district level. This includes information on topics that are relevant to school finance, like housing.</p>
<p>The <code>tidycensus</code> R package makes it easy to access, explore, and analyze Census Bureau data.</p>
<p>Use <code>install.packages("tidycensus")</code> to download the package in RStudio.</p>
</div><div class="column" height="45%" data-fig-align="center" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://walker-data.com/tidycensus/logo.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-height="50%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="to-get-started-youll-need-to-sign-up-for-an-api-key-with-the-census-bureau" class="level2">
<h2 class="anchored" data-anchor-id="to-get-started-youll-need-to-sign-up-for-an-api-key-with-the-census-bureau">To get started, you’ll need to sign up for an API key with the Census Bureau</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://michaeldgarber.github.io/teach-r/images/census-api-key-landing.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p><a href="https://api.census.gov/data/key_signup.html">Signup for an API key here!</a></p>
</section>
</section>
<section id="in-class-exercise" class="level1">
<h1>In-class exercise</h1>
<section id="in-class-coding-example-clean_and_join.r-13" class="level2">
<h2 class="anchored" data-anchor-id="in-class-coding-example-clean_and_join.r-13">In-class coding example: clean_and_join.R (1/3)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load -----------</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(edbuildr)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get your own api key from https://api.census.gov/data/key_signup.html</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># only run this line of code once after you replace the text below</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># with your API key</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="st">"YOUR API KEY GOES HERE"</span>, <span class="at">install =</span> <span class="cn">TRUE</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># get edbuild data</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>edbuild_fy19 <span class="ot">&lt;-</span> <span class="fu">masterpull</span>(<span class="at">data_type =</span> <span class="st">"geo"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># load census variables from 2019 acs 5-year estimates</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>v19 <span class="ot">&lt;-</span> <span class="fu">load_variables</span>(<span class="dv">2019</span>, <span class="st">"acs5"</span>, <span class="at">cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># get mortgage data for unified school districts</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>mortgage_unified_raw <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"B25101_001"</span>, <span class="co"># total households</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"B25101_002"</span>, <span class="co"># total with a mortgage</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"B25101_024"</span>), <span class="co"># total not mortgaged</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                        <span class="at">geography =</span> <span class="st">"school district (unified)"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                        <span class="at">state =</span> <span class="st">"MN"</span>, </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                        <span class="at">year =</span> <span class="dv">2019</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co"># get mortgage data for elementary school districts</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>mortgage_elementary_raw <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"B25101_001"</span>, <span class="co"># total households</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"B25101_002"</span>, <span class="co"># total with a mortgage</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"B25101_024"</span>), <span class="co"># total not mortgaged</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">geography =</span> <span class="st">"school district (elementary)"</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">state =</span> <span class="st">"MN"</span>, </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">year =</span> <span class="dv">2019</span>)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co"># get mortgage data for secondary school districts</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>mortgage_secondary_raw <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"B25101_001"</span>, <span class="co"># total households</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"B25101_002"</span>, <span class="co"># total with a mortgage</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"B25101_024"</span>), <span class="co"># total not mortgaged</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">geography =</span> <span class="st">"school district (secondary)"</span>,</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">state =</span> <span class="st">"MN"</span>, </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">year =</span> <span class="dv">2019</span>)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co"># clean ------------</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co"># clean mortgage data for unified school districts</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>mortgage_pct_unified <span class="ot">&lt;-</span> mortgage_unified_raw <span class="sc">|&gt;</span> </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace vars with more descriptive names</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_001"</span>, <span class="st">"households"</span>),</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_002"</span>, <span class="st">"with_mortgage"</span>),</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_024"</span>, <span class="st">"no_mortgage"</span>)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span>  <span class="co"># close mutate </span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove margin of error column</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>moe) <span class="sc">|&gt;</span> </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pivot variable column into distinct columns</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate percent of households within a school district with a mortgage</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mortgage_pct =</span> with_mortgage <span class="sc">/</span> households) </span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co"># clean mortgage data for elementary school districts</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>mortgage_pct_elementary <span class="ot">&lt;-</span> mortgage_elementary_raw <span class="sc">|&gt;</span> </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_001"</span>, <span class="st">"households"</span>),</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_002"</span>, <span class="st">"with_mortgage"</span>),</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_024"</span>, <span class="st">"no_mortgage"</span>)</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span>  <span class="co"># close mutate </span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>moe) <span class="sc">|&gt;</span> </span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mortgage_pct =</span> with_mortgage <span class="sc">/</span> households)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="co"># clean mortgage data for secondary school districts</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>mortgage_pct_secondary <span class="ot">&lt;-</span> mortgage_secondary_raw <span class="sc">|&gt;</span> </span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_001"</span>, <span class="st">"households"</span>),</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_002"</span>, <span class="st">"with_mortgage"</span>),</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable =</span> <span class="fu">str_replace_all</span>(variable, <span class="st">"B25101_024"</span>, <span class="st">"no_mortgage"</span>)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span>  <span class="co"># close mutate </span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>moe) <span class="sc">|&gt;</span> </span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mortgage_pct =</span> with_mortgage <span class="sc">/</span> households)</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: this data isn't really that useful for mn!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="in-class-coding-example-clean_and_join.r-23" class="level2">
<h2 class="anchored" data-anchor-id="in-class-coding-example-clean_and_join.r-23">In-class coding example: clean_and_join.R (2/3)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join ----------</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># join unified and elementary data by binding rows</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>mortgage_pct_mn <span class="ot">&lt;-</span> mortgage_pct_unified <span class="sc">|&gt;</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(mortgage_pct_elementary) <span class="sc">|&gt;</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out summary row</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">!=</span> <span class="st">"2199999"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange from largest to smallest district</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>households)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># join edbuild and census data using left_join</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>edbuild_mortgage_mn <span class="ot">&lt;-</span> edbuild_fy19 <span class="sc">|&gt;</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Minnesota"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mortgage_pct_mn, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NCESID"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># do the join again, but this time select for the columns we want to keep</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># to avoid duplicates like district.x and district.y</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>edbuild_mortgage_mn <span class="ot">&lt;-</span> edbuild_fy19 <span class="sc">|&gt;</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Minnesota"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mortgage_pct_mn <span class="sc">|&gt;</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(GEOID, households, with_mortgage, mortgage_pct),</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NCESID"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>))</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># use anti_join() to check for districts with no mortgage data</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>edbuild_mortgage_mn_no_match <span class="ot">&lt;-</span> edbuild_fy19 <span class="sc">|&gt;</span> </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Minnesota"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(mortgage_pct_mn <span class="sc">|&gt;</span> </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(GEOID,households, with_mortgage, mortgage_pct),</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NCESID"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>))</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># run the reverse anti_join to see if the census data has </span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#  districts not included in the edbuild table</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>mortgage_edbuild_mn_no_match <span class="ot">&lt;-</span> mortgage_pct_mn <span class="sc">|&gt;</span> </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID,households, with_mortgage, mortgage_pct) <span class="sc">|&gt;</span> </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(edbuild_fy19 <span class="sc">|&gt;</span> </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Minnesota"</span>) ,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"NCESID"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="in-class-coding-example-clean_and_join.r-33" class="level2">
<h2 class="anchored" data-anchor-id="in-class-coding-example-clean_and_join.r-33">In-class coding example: clean_and_join.R (3/3)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot -----------</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># first plot of the joined dataset</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(edbuild_mortgage_mn) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> MHI, <span class="at">y =</span> mortgage_pct, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> StPovRate, <span class="at">size =</span> ENROLL),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">max_size =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"MHI"</span>, <span class="at">y =</span> <span class="st">"Percent of households with a mortgage"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Poverty rate"</span>, <span class="at">size =</span> <span class="st">"Enrollment"</span>) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># facet by sdType</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(edbuild_mortgage_mn) <span class="sc">+</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> MHI, <span class="at">y =</span> mortgage_pct, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> StPovRate, <span class="at">size =</span> ENROLL),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">max_size =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"MHI"</span>, <span class="at">y =</span> <span class="st">"Percent of households with a mortgage"</span>,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Poverty rate"</span>, <span class="at">size =</span> <span class="st">"Enrollment"</span>) <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sdType) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out secondary districts and create better labels for </span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># elementary and unified districts</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(edbuild_mortgage_mn <span class="sc">|&gt;</span> </span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(sdType <span class="sc">!=</span> <span class="st">"secon"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">sdType =</span> <span class="fu">case_when</span>(sdType <span class="sc">==</span> <span class="st">"elem"</span> <span class="sc">~</span> <span class="st">"Elementary"</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>                                   sdType <span class="sc">==</span> <span class="st">"uni"</span> <span class="sc">~</span> <span class="st">"Unified"</span>))) <span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> MHI, <span class="at">y =</span> mortgage_pct, </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> StPovRate, <span class="at">size =</span> ENROLL),</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">max_size =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"MHI"</span>, <span class="at">y =</span> <span class="st">"Percent of households with a mortgage"</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Poverty rate"</span>, <span class="at">size =</span> <span class="st">"Enrollment"</span>) <span class="sc">+</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sdType) <span class="sc">+</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co"># same chart, but filter  allow for free x+y axis scales</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(edbuild_mortgage_mn <span class="sc">|&gt;</span> </span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(sdType <span class="sc">!=</span> <span class="st">"secon"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">sdType =</span> <span class="fu">case_when</span>(sdType <span class="sc">==</span> <span class="st">"elem"</span> <span class="sc">~</span> <span class="st">"Elementary"</span>,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>                                   sdType <span class="sc">==</span> <span class="st">"uni"</span> <span class="sc">~</span> <span class="st">"Unified"</span>))) <span class="sc">+</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> MHI, <span class="at">y =</span> mortgage_pct, </span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> StPovRate, <span class="at">size =</span> ENROLL),</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">max_size =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"MHI"</span>, <span class="at">y =</span> <span class="st">"Percent of households with a mortgage"</span>,</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Poverty rate"</span>, <span class="at">size =</span> <span class="st">"Enrollment"</span>) <span class="sc">+</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sdType, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="homework-assignment" class="level1">
<h1>Homework assignment</h1>
<section id="this-weeks-assignment" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="this-weeks-assignment">This week’s assignment</h2>
<p><strong>Reading assignment</strong></p>
<ul>
<li><a href="https://bellwether.org/wp-content/uploads/2021/10/Bellwether_SplittingBill_05-HowCanSchoolFinStudentswLearnNeeds_Final.pdf"><strong><em>How Can School Finance Systems Support Students with Additional Learning Needs?</em></strong></a></li>
</ul>
<p><strong>Coding task</strong></p>
<p>Clean your state’s district data and make sure that you have all of the data you need to model your state’s funding formula and the potential policy changes you want to make. This may require joining dataframes, <code>pivot_longer()</code>, <code>pivot_wider()</code> and/or using <code>mutate()</code> to merge, reshape, and tidy data from your state.</p>
<p>Ultimately, you’ll want to produce a single dataframe where:</p>
<ul>
<li>Each row represents a single LEA (traditional district or charter school)</li>
<li>Each column represents a single variable</li>
<li>All of the data elements that go into your current formula are present in the dataframe.</li>
</ul>
<p>If you need to join more than two dataframes, <strong>just start with joining two dataframes for this assingment.</strong> We can work on building the full dataset you’ll need to model your formula over the coming weeks.</p>
<p>To get started, a template R script is included: <code>scripts/dist_clean.R</code> – please use that file to load, clean, and save your tidy data.</p>
<p>As always, once you’ve completed the assignment, be sure to commit and push to GitHub!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>